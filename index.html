<!DOCTYPE html>
<html>
  <head>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
  </head>
<body>
  <div id="viz"></div>

  <script type="text/javascript">

    var data;


    d3.json("https://gist.githubusercontent.com/kevinjhanna/6d640d98ac67cc8da44a/raw/ac7e05866694444cb96fd903bcbd5c82b5e2dcfa/gistfile1.txt", function(error, json) {
        if (error) return console.warn(error);
        data = json;
        run();
    });


    var height = 3000,
        width = 300,
        circleRadio = 5

    var colors = d3.scale.category10()

    function run() {
      // data = data.slice(0, 10)

      console.log(data);
      var svg = d3.select("#viz").append("svg").attr("width", width).attr("height", height);

      var y = d3.scale.linear()
            .domain ([0, data.length])
            .range([circleRadio + 50, height - circleRadio]);

      var totalEnglishWords = data.reduce(function(a, b) {
          return a + b.words.length;
      }, 0);

      var wordY = d3.scale.linear()
            .domain ([0, totalEnglishWords])
            .range([circleRadio + 50, height - circleRadio]);

      console.log('ingles: ' + totalEnglishWords)
      console.log('espa√±ol: ' + data.length)

      var relations = svg
        .selectAll('g')
        .data(data)
        .enter()
        .append('g')


      var blueI = 0
      var nested = relations
        .selectAll("g")
        .data(function(d, i) { return d.words.map(function(w) { return { hay: d.words.length, word: w, voy: i, soy: blueI++ } } ); })
        .enter()

        nested
          .append('line')
          .attr('x1', circleRadio + 100)
          .attr('x2', width - circleRadio -100)
          .attr('y1', function(d, i) { return wordY(d.soy); })
          .attr('y2', function(d, i) { return y(d.voy); })
          .style('stroke', function(d, i) { return colors(d.hay) } )

        nested.append("circle")
          .attr('r', circleRadio)
          .attr('cx', circleRadio + 100)
          .attr('cy', function(d, i) { return wordY(d.soy); })
          .style('fill', 'blue')
          .append("svg:title").text(function(d) { return d.word; })

        relations
          .append('circle')
          .attr('r', circleRadio)
          .attr('cx', width - circleRadio - 100)
          .attr('cy', function(d, i) { return y(i); })
          .style('stroke', 'white')
      //    .append("svg:title").text(function(d) { return d.translation; })
    
    
         nested.append("text")                    
           .attr("x", circleRadio + 100 - 20)
           .attr("y", function(d, i) { return wordY(d.soy); })
           .text(function(d){ return d.word;})
           .attr("font-family", "Verdana")
           .attr("font-size", "16px")
           .attr("text-anchor", "end")
           .attr("fill", "black");
      
          relations.append("text")                    
           .attr("x", width - circleRadio - 100 + 20)
           .attr("y", function(d, i) { return y(i); })
           .text(function(d){ return d.translation;})
           .attr("font-family", "Verdana")
           .attr("font-size", "16px")
           .attr("text-anchor", "start")
           .attr("fill", "black");

    }

      // var circle = svg.append("circle")
      // .attr("r", 40).attr("cx", 50).attr("cy", 50).style("stroke", "white").style("fill", "black")
      // .on("mouseover", function() { d3.select(this).style("fill", "gray");  })
      // .on("mouseout" , function() { d3.select(this).style("fill", "black"); })
  </script>
  </body>
</html>
